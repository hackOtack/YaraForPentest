rule libxerces_SAXParser{
	meta:
    description = "Detects vulnerable APIs in libxerces-c/SAXParser/SAX2XMLReader"
		reference = "https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#cc"

	strings:
		//vulnerable APIs
		$api1 = "new XercesDOMParser"
		$api2 = "new SAXParser"
		$api3 = "SAX2XMLReader"

		//safe parameters
		$param1_1 = "setCreateEntityReferenceNodes(true)"
		$param1_2 = "setDisableDefaultEntityResolution(true)"
		$param2 = "setDisableDefaultEntityResolution(true)"
		$param3 = "setFeature(XMLUni::fgXercesDisableDefaultEntityResolution, true)"

	condition:
		$api1 and not ($param1_1 or $param1_2)
		or 
		$api2 and not $param2
		or
		$api3 and not $param3
}
